on:
  push:
    branches: 
    - 'feature/**'
    - 'hotfix/**'

jobs:
  create_pr_for_feature_push:
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - uses: actions/github-script@v5
        with:
          script: |
            const [branchType, number, ...name] = "${{ github.ref_name }}".split("/")
            console.log(`${branchType}, issue ${number}`)
            const issueResp = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: number,
            });
            
            console.log(`issueResp = ${JSON.stringify(issueResp)}`)
            
            github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              // title: `${issueResp["data"]["number"]} - ${issueResp["data"]["title"]}`,
              head: "${{ github.ref }}",
              base: branchType === "hotfix" ? "refs/heads/main" : "refs/heads/develop",
              body: issueResp["data"]["body"],
              draft: true,
              issue: issueResp["data"]["number"] // No title needed when an issue gets linked
            });
